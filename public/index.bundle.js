(()=>{"use strict";const e=function(e,t){void 0===e&&(e=-100),void 0===t&&(t=-100),this.x=e,this.y=t},t=function(){function t(){this.mouseDown=!1,this.ctrlDown=!1,this.paste=!1,this.cut=!1,this.lastMousePosition=new e,this.selectedTileFromCBPostition=new e,this.selectedTileFromMapPosition=new e,this.selectedTilesWithCtrl=[],this.copiedTiles=[],this.canvasCopiesToUndo=[],this.canvasCopiesToRedo=[]}return t.prototype.cloneCanvas=function(e){var t=document.createElement("canvas"),o=t.getContext("2d");return t.width=e.width,t.height=e.height,o.drawImage(e,0,0),t},t.prototype.saveCanvasToUndo=function(e){this.canvasCopiesToUndo.length>=5&&this.canvasCopiesToUndo.pop(),this.canvasCopiesToUndo.unshift(this.cloneCanvas(e))},t.prototype.saveCanvasToRedo=function(e){this.canvasCopiesToRedo.length>=5&&this.canvasCopiesToRedo.pop(),this.canvasCopiesToRedo.unshift(this.cloneCanvas(e))},t.prototype.undoChangesOnCanvas=function(e){this.canvasCopiesToUndo.length>0&&(this.saveCanvasToRedo(e),e.getContext("2d").drawImage(this.canvasCopiesToUndo[0],0,0),this.canvasCopiesToUndo.shift())},t.prototype.redoChangesOnCanvas=function(e){this.canvasCopiesToRedo.length>0&&(this.saveCanvasToUndo(e),e.getContext("2d").drawImage(this.canvasCopiesToRedo[0],0,0),this.canvasCopiesToRedo.shift())},t.prototype.mouseMoveOnCanvas=function(e,t){var o=this;e.addEventListener("mousemove",(function(n){var i=n.offsetX-n.offsetX%24,s=n.offsetY-n.offsetY%24;o.lastMousePosition.x==i&&o.lastMousePosition.y==s||(t(),e.getContext("2d").strokeStyle="red",e.getContext("2d").strokeRect(i,s,24,24),o.lastMousePosition.x=i,o.lastMousePosition.y=s)}))},t.prototype.selectTile=function(e,t){var o=this;e.addEventListener("click",(function(n){t();var i=n.offsetX-n.offsetX%24,s=n.offsetY-n.offsetY%24;e.getContext("2d").strokeStyle="white",e.getContext("2d").lineWidth=5,e.getContext("2d").strokeRect(i-2,s-2,26,26),o.selectedTileFromCBPostition.x=i,o.selectedTileFromCBPostition.y=s}))},t.prototype.selectMultipleTiles=function(t,o,n){var i=this;document.querySelector("body").addEventListener("keydown",(function(e){"Meta"==e.key||"Control"==e.key?i.ctrlDown=!0:"Delete"==e.key?(i.saveCanvasToUndo(t),t.getContext("2d").fillStyle="black",i.ctrlDown?(i.selectedTilesWithCtrl.forEach((function(e){t.getContext("2d").fillRect(e.x,e.y,24,24)})),i.selectedTilesWithCtrl=[]):t.getContext("2d").fillRect(i.selectedTileFromMapPosition.x,i.selectedTileFromMapPosition.y,24,24)):"KeyC"==e.code&&i.ctrlDown?i.selectedTilesWithCtrl.length>0&&(i.copiedTiles=i.selectedTilesWithCtrl,i.selectedTilesWithCtrl=[]):"KeyV"==e.code&&i.ctrlDown?(i.paste=!0,i.saveCanvasToUndo(t)):"KeyZ"==e.code&&i.ctrlDown?i.undoChangesOnCanvas(t):"KeyX"==e.code&&i.ctrlDown?i.selectedTilesWithCtrl.length>0&&(i.cutCanvas=i.cloneCanvas(t),i.saveCanvasToUndo(t),i.copiedTiles=i.selectedTilesWithCtrl,i.selectedTilesWithCtrl.forEach((function(e){t.getContext("2d").fillRect(e.x,e.y,24,24)})),i.cut=!0,i.selectedTilesWithCtrl=[]):"KeyY"==e.code&&i.ctrlDown&&i.redoChangesOnCanvas(t)})),document.querySelector("body").addEventListener("keyup",(function(e){"Meta"!=e.key&&"Control"!=e.key||(i.paste||i.selectedTilesWithCtrl.forEach((function(e){t.getContext("2d").drawImage(o,i.selectedTileFromCBPostition.x,i.selectedTileFromCBPostition.y,24,24,e.x,e.y,24,24)})),i.ctrlDown=!1,i.selectedTilesWithCtrl=[])})),t.addEventListener("contextmenu",(function(e){e.preventDefault()})),t.addEventListener("mousedown",(function(e){i.selectedTileFromMapPosition.x=e.offsetX-e.offsetX%24,i.selectedTileFromMapPosition.y=e.offsetY-e.offsetY%24,i.mouseDown=!0})),t.addEventListener("mousemove",(function(e){var o=e.offsetX-e.offsetX%24,s=e.offsetY-e.offsetY%24,r=i.selectedTileFromMapPosition.x<o?i.selectedTileFromMapPosition.x:o,a=i.selectedTileFromMapPosition.y<s?i.selectedTileFromMapPosition.y:s;if(i.mouseDown){n(),t.getContext("2d").strokeStyle="red";for(var l=0;l<=Math.abs(o-i.selectedTileFromMapPosition.x)/24;l++)for(var c=0;c<=Math.abs(s-i.selectedTileFromMapPosition.y)/24;c++)t.getContext("2d").strokeRect(24*l+r,24*c+a,24,24)}i.paste&&(t.getContext("2d").drawImage(i.canvasCopiesToUndo[0],0,0),i.copiedTiles.forEach((function(e,n){t.getContext("2d").strokeRect(e.x,e.y,24,24),t.getContext("2d").strokeRect(o+e.x-i.copiedTiles[0].x,s+e.y-i.copiedTiles[0].y,24,24),t.getContext("2d").drawImage(i.cut?i.cutCanvas:i.canvasCopiesToUndo[0],e.x,e.y,24,24,o+e.x-i.copiedTiles[0].x,s+e.y-i.copiedTiles[0].y,24,24)}))),i.ctrlDown&&(t.getContext("2d").strokeStyle="red",i.selectedTilesWithCtrl.forEach((function(e){t.getContext("2d").strokeRect(e.x,e.y,24,24)})))})),t.addEventListener("mouseup",(function(n){i.mouseDown=!1;var s=n.offsetX-n.offsetX%24,r=n.offsetY-n.offsetY%24,a=i.selectedTileFromMapPosition.x<s?i.selectedTileFromMapPosition.x:s,l=i.selectedTileFromMapPosition.y<r?i.selectedTileFromMapPosition.y:r;if(i.paste)i.copiedTiles.forEach((function(e,o){t.getContext("2d").drawImage(i.cut?i.cutCanvas:i.canvasCopiesToUndo[0],e.x,e.y,24,24,s+e.x-i.copiedTiles[0].x,r+e.y-i.copiedTiles[0].y,24,24)})),i.saveCanvasToUndo(t),i.copiedTiles=[],i.paste=!1,i.cut=!1;else if(i.ctrlDown)for(d=0;d<=Math.abs(s-i.selectedTileFromMapPosition.x)/24;d++){var c=function(t){var o=24*d+a,n=24*t+l,s=i.selectedTilesWithCtrl.findIndex((function(e){return e.x==o&&e.y==n}));-1==s?i.selectedTilesWithCtrl.push(new e(24*d+a,24*t+l)):i.selectedTilesWithCtrl.splice(s,1)};for(h=0;h<=Math.abs(r-i.selectedTileFromMapPosition.y)/24;h++)c(h)}else{i.saveCanvasToUndo(t);for(var d=0;d<=Math.abs(s-i.selectedTileFromMapPosition.x)/24;d++)for(var h=0;h<=Math.abs(r-i.selectedTileFromMapPosition.y)/24;h++)t.getContext("2d").drawImage(o,i.selectedTileFromCBPostition.x,i.selectedTileFromCBPostition.y,24,24,24*d+a,24*h+l,24,24)}}))},t}(),o=function(){function e(e,t,o,n,i,s){this.width=o,this.height=n,this.DOMElement=e,this.tileHeight=s,this.tileWidth=i,this.DOMElement.width=this.width,this.DOMElement.height=this.height,this.DOMElement.getContext("2d").fillRect(0,0,this.width,this.height),t.appendChild(this.DOMElement)}return e.prototype.getDOMElement=function(){return this.DOMElement},e}();var n,i=(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)});const s=function(e){function t(t,o,n,i,s,r){return e.call(this,t,o,n,i,s,r)||this}return i(t,e),t.prototype.fillBoard=function(e){this.DOMElement.getContext("2d").drawImage(e,0,0,e.width/2,e.height,0,0,e.width/4,e.height/2),this.DOMElement.getContext("2d").drawImage(e,e.width/2,0,e.width/2,e.height,0,e.height/2,e.width/4,e.height/2)},t}(o);var r=function(){var e=function(t,o){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])},e(t,o)};return function(t,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),a=function(e){function t(t,o,n,i,s,r){return e.call(this,t,o,n,i,s,r)||this}return r(t,e),t.prototype.drawGrid=function(){this.DOMElement.getContext("2d").strokeStyle="#ffffff";for(var e=0;e<this.width/this.tileWidth;e++)for(var t=0;t<this.height/this.tileHeight;t++)this.DOMElement.getContext("2d").strokeRect(e*this.tileWidth,t*this.tileHeight,24,24)},t.prototype.drawImage=function(e,t,o,n,i){this.DOMElement.getContext("2d").drawImage(e,t,o,24,24,n,i,24,24)},t}(o);const l=a;var c=new t,d=new s(document.createElement("canvas"),document.querySelector("#board"),384,960,24,24),h=new l(document.createElement("canvas"),document.querySelector("#map"),960,960,24,24);h.drawGrid();var f=new Image;f.src="sprites.png",f.onload=function(){return d.fillBoard(f)},c.mouseMoveOnCanvas(h.getDOMElement(),(function(){return h.drawGrid()})),c.selectTile(d.getDOMElement(),(function(){return d.fillBoard(f)})),c.selectMultipleTiles(h.getDOMElement(),d.getDOMElement(),(function(){return h.drawGrid()}))})();